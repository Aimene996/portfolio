# Flutter Firebase Setup - View Contact Messages

This guide will help you set up a Flutter app to view contact form messages from your portfolio website.

## Prerequisites

- Flutter SDK installed
- Firebase project created (same one used for the web portfolio)
- Android Studio / VS Code with Flutter extensions

## Step 1: Create Flutter Project

```bash
flutter create portfolio_admin
cd portfolio_admin
```

## Step 2: Add Firebase to Flutter

### Option A: Using FlutterFire CLI (Recommended)

1. Install FlutterFire CLI:
```bash
dart pub global activate flutterfire_cli
```

2. Configure Firebase for your Flutter app:
```bash
flutterfire configure
```

This will:
- Detect your Firebase projects
- Let you select the project
- Configure for iOS, Android, Web, etc.
- Generate `firebase_options.dart`

### Option B: Manual Setup

1. Go to Firebase Console > Project Settings
2. Add an Android app (or iOS app)
3. Download `google-services.json` (Android) or `GoogleService-Info.plist` (iOS)
4. Place the file in the appropriate location:
   - Android: `android/app/google-services.json`
   - iOS: `ios/Runner/GoogleService-Info.plist`

## Step 3: Add Dependencies

Add to `pubspec.yaml`:

```yaml
dependencies:
  flutter:
    sdk: flutter
  firebase_core: ^3.0.0
  cloud_firestore: ^5.0.0
  intl: ^0.19.0  # For date formatting
```

Then run:
```bash
flutter pub get
```

## Step 4: Initialize Firebase in Flutter

Update `lib/main.dart`:

```dart
import 'package:flutter/material.dart';
import 'package:firebase_core/firebase_core.dart';
import 'firebase_options.dart'; // Generated by flutterfire configure

void main() async {
  WidgetsFlutterBinding.ensureInitialized();
  await Firebase.initializeApp(
    options: DefaultFirebaseOptions.currentPlatform,
  );
  runApp(const MyApp());
}

class MyApp extends StatelessWidget {
  const MyApp({super.key});

  @override
  Widget build(BuildContext context) {
    return MaterialApp(
      title: 'Portfolio Admin',
      theme: ThemeData(
        primarySwatch: Colors.blue,
        useMaterial3: true,
      ),
      home: const MessagesScreen(),
    );
  }
}
```

## Step 5: Create Messages Screen

Create `lib/screens/messages_screen.dart`:

```dart
import 'package:flutter/material.dart';
import 'package:cloud_firestore/cloud_firestore.dart';
import 'package:intl/intl.dart';

class MessagesScreen extends StatefulWidget {
  const MessagesScreen({super.key});

  @override
  State<MessagesScreen> createState() => _MessagesScreenState();
}

class _MessagesScreenState extends State<MessagesScreen> {
  final FirebaseFirestore _firestore = FirebaseFirestore.instance;

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(
        title: const Text('Contact Messages'),
        backgroundColor: Colors.pink,
        foregroundColor: Colors.white,
      ),
      body: StreamBuilder<QuerySnapshot>(
        stream: _firestore
            .collection('messages')
            .orderBy('timestamp', descending: true)
            .snapshots(),
        builder: (context, snapshot) {
          if (snapshot.connectionState == ConnectionState.waiting) {
            return const Center(child: CircularProgressIndicator());
          }

          if (snapshot.hasError) {
            return Center(
              child: Text('Error: ${snapshot.error}'),
            );
          }

          if (!snapshot.hasData || snapshot.data!.docs.isEmpty) {
            return const Center(
              child: Text('No messages yet'),
            );
          }

          final messages = snapshot.data!.docs;

          return ListView.builder(
            itemCount: messages.length,
            itemBuilder: (context, index) {
              final message = messages[index];
              final data = message.data() as Map<String, dynamic>;
              final name = data['name'] ?? 'Unknown';
              final email = data['email'] ?? 'No email';
              final messageText = data['message'] ?? '';
              final timestamp = data['timestamp'] as Timestamp?;
              final read = data['read'] ?? false;

              return Card(
                margin: const EdgeInsets.symmetric(
                  horizontal: 16,
                  vertical: 8,
                ),
                color: read ? Colors.grey[100] : Colors.white,
                child: ListTile(
                  contentPadding: const EdgeInsets.all(16),
                  title: Row(
                    children: [
                      Expanded(
                        child: Text(
                          name,
                          style: TextStyle(
                            fontWeight: read ? FontWeight.normal : FontWeight.bold,
                          ),
                        ),
                      ),
                      if (!read)
                        Container(
                          width: 12,
                          height: 12,
                          decoration: const BoxDecoration(
                            color: Colors.pink,
                            shape: BoxShape.circle,
                          ),
                        ),
                    ],
                  ),
                  subtitle: Column(
                    crossAxisAlignment: CrossAxisAlignment.start,
                    children: [
                      const SizedBox(height: 8),
                      Text(
                        email,
                        style: TextStyle(
                          color: Colors.blue[700],
                          fontSize: 14,
                        ),
                      ),
                      const SizedBox(height: 8),
                      Text(
                        messageText,
                        style: const TextStyle(fontSize: 14),
                      ),
                      if (timestamp != null) ...[
                        const SizedBox(height: 8),
                        Text(
                          DateFormat('MMM dd, yyyy - HH:mm').format(
                            timestamp.toDate(),
                          ),
                          style: TextStyle(
                            color: Colors.grey[600],
                            fontSize: 12,
                          ),
                        ),
                      ],
                    ],
                  ),
                  onTap: () {
                    // Mark as read
                    if (!read) {
                      message.reference.update({'read': true});
                    }
                    // Show full message dialog
                    _showMessageDialog(context, data);
                  },
                ),
              );
            },
          );
        },
      ),
      floatingActionButton: FloatingActionButton(
        onPressed: () {
          // Refresh messages
          setState(() {});
        },
        child: const Icon(Icons.refresh),
      ),
    );
  }

  void _showMessageDialog(BuildContext context, Map<String, dynamic> data) {
    showDialog(
      context: context,
      builder: (context) => AlertDialog(
        title: Text(data['name'] ?? 'Unknown'),
        content: SingleChildScrollView(
          child: Column(
            crossAxisAlignment: CrossAxisAlignment.start,
            mainAxisSize: MainAxisSize.min,
            children: [
              Text('Email: ${data['email'] ?? 'No email'}'),
              const SizedBox(height: 16),
              Text('Message:'),
              const SizedBox(height: 8),
              Text(data['message'] ?? ''),
            ],
          ),
        ),
        actions: [
          TextButton(
            onPressed: () => Navigator.pop(context),
            child: const Text('Close'),
          ),
        ],
      ),
    );
  }
}
```

## Step 6: Set Up Firestore Security Rules

In Firebase Console > Firestore Database > Rules:

```javascript
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // Allow read for authenticated users (you can add authentication later)
    // For now, allow read for testing (NOT for production!)
    match /messages/{messageId} {
      allow read: if true; // Change this to authenticated users in production
      allow write: if false; // Only API route can write
      allow update: if true; // Allow updating read status
    }
  }
}
```

**⚠️ Important:** For production, add authentication and restrict read access!

## Step 7: Run the App

```bash
flutter run
```

## Step 8: Test

1. Submit a message from your portfolio website
2. Check your Flutter app - the message should appear in real-time!

## Optional: Add Authentication

For production, add Firebase Authentication:

1. Enable Authentication in Firebase Console
2. Add `firebase_auth` to `pubspec.yaml`
3. Create a login screen
4. Update Firestore rules to require authentication:

```javascript
match /messages/{messageId} {
  allow read: if request.auth != null;
  allow write: if false;
  allow update: if request.auth != null;
}
```

## Troubleshooting

### Error: "MissingPluginException"
- Run `flutter clean`
- Run `flutter pub get`
- Restart the app

### Messages not appearing
- Check Firestore security rules
- Verify Firebase is initialized correctly
- Check console for errors

### Build errors
- Make sure `google-services.json` is in the correct location
- Run `flutter clean` and rebuild

## Next Steps

- Add authentication for security
- Add message filtering/search
- Add delete functionality
- Add email notifications
- Add push notifications for new messages

